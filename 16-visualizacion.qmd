# Visualización de datos: mostrar para convencer {#visualizacion}

## Un buen gráfico vale más que mil regresiones

Exagero. Pero no tanto. La visualización de datos es probablemente la habilidad más subestimada en las ciencias sociales. Puedes tener el análisis más sofisticado del mundo, pero si lo presentas en una tabla ilegible de 15 columnas, nadie lo va a entender (ni le va a importar).

La visualización no es "hacer gráficos bonitos." Es **comunicar evidencia de forma efectiva.** Y como toda comunicación, requiere pensar en tu audiencia, tu mensaje, y la forma más clara de transmitirlo [@healy2018].

Como dice @cairo2016: "Un gráfico no es un adorno. Es un argumento visual." Si tu gráfico no argumenta nada, sobra.

## Principios fundamentales

### 1. Cada gráfico responde una pregunta

Si no puedes decir en una frase qué pregunta responde tu gráfico, probablemente no necesitas ese gráfico. "¿Cómo se distribuye el ingreso?" "¿Hay diferencia entre hombres y mujeres?" "¿Ha cambiado con el tiempo?"

@knaflic2015 lo llama el "¿y qué?" (*so what?*). Antes de hacer cualquier gráfico, pregúntate: si alguien ve esto, ¿qué conclusión debería sacar? Si no tienes una respuesta clara, el gráfico no tiene propósito.

### 2. El ratio data-ink de Tufte

Edward @tufte2001 propuso un principio sencillo pero revolucionario: **maximizar el ratio data-ink.** Es decir, la mayor proporción posible de la tinta de tu gráfico debe representar datos. Todo lo demás (decoraciones, líneas de grilla innecesarias, fondos, bordes) es "tinta sin datos" (*non-data ink*) y debería eliminarse.

$$\text{Data-ink ratio} = \frac{\text{Tinta que representa datos}}{\text{Tinta total del gráfico}}$$

En la práctica, esto significa: elimina todo lo que no aporta información. Líneas de grilla innecesarias, leyendas redundantes, colores sin propósito, efectos 3D (por favor, nunca 3D), fondos decorativos, bordes alrededor del gráfico.

::: {.callout-note}
## Para recordar

La regla de Tufte tiene sus críticos. A veces, un poco de "tinta sin datos" mejora la legibilidad (como líneas de grilla sutiles que ayudan a leer valores). El principio no es "elimina todo" sino "justifica todo." Si un elemento visual no aporta, elimínalo. Si aporta a la legibilidad, mantenlo.
:::

### 3. La honestidad visual

Un gráfico puede mentir sin falsificar un solo dato. Basta con manipular los ejes, elegir colores engañosos, o truncar la escala. @cairo2016 dedica un libro entero a la "veracidad" en la visualización.

```{r}
#| label: fig-eje-honesto
#| fig-cap: "El mismo dato, dos historias: a la izquierda, eje truncado que exagera la diferencia. A la derecha, eje completo que muestra la proporción real."
#| echo: false
#| message: false
#| fig-width: 10
#| fig-height: 4

library(tidyverse)
library(patchwork)

datos <- tibble(
  grupo = c("Programa A", "Programa B"),
  valor = c(72, 78)
)

p1 <- ggplot(datos, aes(x = grupo, y = valor, fill = grupo)) +
  geom_col(width = 0.6) +
  coord_cartesian(ylim = c(70, 80)) +
  scale_fill_manual(values = c("#E74C3C", "#3498DB")) +
  labs(title = "❌ Eje truncado", y = "Puntaje", x = "") +
  theme_minimal() +
  theme(legend.position = "none")

p2 <- ggplot(datos, aes(x = grupo, y = valor, fill = grupo)) +
  geom_col(width = 0.6) +
  scale_fill_manual(values = c("#E74C3C", "#3498DB")) +
  labs(title = "✅ Eje completo", y = "Puntaje", x = "") +
  theme_minimal() +
  theme(legend.position = "none")

p1 + p2
```

Formas comunes de mentir con gráficos:

| Truco | Cómo miente | Ejemplo |
|---|---|---|
| **Eje Y truncado** | Exagera diferencias pequeñas | Una diferencia de 2% parece abismal |
| **Doble eje Y** | Sugiere relación donde no la hay | "El consumo de helado y los ahogamientos correlacionan" |
| **Área 3D** | Distorsiona proporciones por perspectiva | Tortas 3D donde las porciones del frente parecen más grandes |
| **Cherry-picking temporal** | Selecciona período que favorece tu argumento | "El crimen bajó" (pero empezaste a contar desde el pico) |
| **Colores manipuladores** | Rojo = malo, verde = bueno cuando no corresponde | Hacer que tu grupo se vea "positivo" |

### 4. Color con propósito

El color debe **codificar información**, no decorar. Reglas prácticas:

- **Datos categóricos:** Usa colores cualitativamente distintos (no un gradiente). Máximo 5-6 categorías con color; más de eso, busca otra codificación.
- **Datos secuenciales:** Usa un gradiente de un solo color (más oscuro = más valor). Ejemplo: mapa coroplético de IDH.
- **Datos divergentes:** Usa dos colores que divergen desde un punto neutral. Ejemplo: diferencias respecto a la media (azul = debajo, rojo = arriba).
- **Accesibilidad:** ~8% de los hombres son daltónicos. Evita la combinación rojo-verde. Usa paletas accesibles como `viridis` en R o las paletas de ColorBrewer.

::: {.callout-warning}
## Sobre daltonismo

Si tu gráfico depende de distinguir rojo de verde para entenderse, excluyes al 8% de los hombres (y al ~0.5% de las mujeres). Usa paletas como `viridis`, `cividis`, o las paletas de `RColorBrewer` tipo "qualitative." En ggplot2: `scale_fill_viridis_d()` para datos discretos, `scale_fill_viridis_c()` para continuos.
:::

### 5. Texto integrado y etiquetas directas

Las mejores visualizaciones integran el texto en el gráfico: títulos descriptivos, anotaciones que señalan patrones, etiquetas directas en lugar de leyendas separadas.

- **Título descriptivo, no genérico.** ❌ "Gráfico 1: Pobreza por región." ✅ "La pobreza se concentra en las regiones rurales del sur."
- **Etiquetas directas** en las líneas/barras en lugar de leyendas. Reduce el trabajo cognitivo del lector.
- **Anotaciones** para señalar puntos clave: "Aquí empezó el programa" o "Este es el valor más alto desde 2010."
- **Subtítulo** para dar contexto metodológico: "Datos de la ENAHO 2023. N = 35,400 hogares."

### 6. Small multiples: la alternativa al hacinamiento

Cuando quieres mostrar el mismo patrón para muchos grupos, en vez de meter todo en un solo gráfico (que se vuelve ilegible), usa **small multiples** (o *facets* en ggplot2): el mismo gráfico repetido para cada grupo, con los mismos ejes [@tufte2001].

Ventajas:

- Cada grupo se ve con claridad.
- La comparación visual es inmediata.
- No necesitas 15 colores diferentes.

En ggplot2: `facet_wrap(~ variable)` o `facet_grid(fila ~ columna)`.

## Catálogo de visualizaciones por propósito

### Distribución: ¿cómo se ven tus datos?

```{r}
#| label: fig-distribucion
#| fig-cap: "Tres formas de visualizar una distribución: histograma, densidad y boxplot"
#| echo: false
#| message: false
#| fig-width: 10
#| fig-height: 4

library(tidyverse)
library(patchwork)

set.seed(42)
ingresos <- tibble(
  ingreso = c(rlnorm(500, meanlog = 7, sdlog = 0.8)),
  grupo = sample(c("Urbano", "Rural"), 500, replace = TRUE, prob = c(0.6, 0.4))
)

p1 <- ggplot(ingresos, aes(x = ingreso)) +
  geom_histogram(fill = "#3498DB", bins = 30, alpha = 0.8) +
  labs(title = "Histograma", x = "Ingreso mensual", y = "Frecuencia") +
  theme_minimal()

p2 <- ggplot(ingresos, aes(x = ingreso, fill = grupo)) +
  geom_density(alpha = 0.5) +
  scale_fill_manual(values = c("#E74C3C", "#3498DB")) +
  labs(title = "Densidad por grupo", x = "Ingreso mensual", y = "Densidad") +
  theme_minimal() +
  theme(legend.position = "bottom")

p3 <- ggplot(ingresos, aes(x = grupo, y = ingreso, fill = grupo)) +
  geom_boxplot(alpha = 0.7) +
  scale_fill_manual(values = c("#E74C3C", "#3498DB")) +
  labs(title = "Boxplot comparativo", x = "", y = "Ingreso mensual") +
  theme_minimal() +
  theme(legend.position = "none")

p1 + p2 + p3
```

**Cuándo usar cada uno:**

| Gráfico | Mejor para | Evitar cuando |
|---|---|---|
| **Histograma** | Ver la forma de la distribución de una variable | Tienes pocas observaciones (<30) |
| **Densidad** | Comparar distribuciones de 2-3 grupos | Tienes más de 4 grupos (se vuelve ilegible) |
| **Boxplot** | Comparar medianas y dispersión entre grupos | Quieres ver la forma exacta de la distribución |
| **Violin plot** | Ver distribución Y comparar grupos | Audiencia no familiarizada con el formato |
| **Ridgeline** | Comparar distribuciones de muchos grupos | Pocas categorías (mejor usar densidades) |

### Relación entre variables: ¿hay un patrón?

```{r}
#| label: fig-scatter
#| fig-cap: "Diagrama de dispersión con línea de tendencia: relación entre gasto en educación y puntajes PISA (datos simulados)"
#| echo: false
#| message: false

library(tidyverse)

set.seed(99)
n_paises <- 40
pisa_data <- tibble(
  pais = paste0("País ", 1:n_paises),
  gasto_educ = runif(n_paises, 2, 8),
  pisa_score = 350 + 25 * gasto_educ + rnorm(n_paises, 0, 30),
  region = sample(c("Am. Latina", "Europa", "Asia", "África"),
                  n_paises, replace = TRUE,
                  prob = c(0.35, 0.3, 0.2, 0.15))
)

ggplot(pisa_data, aes(x = gasto_educ, y = pisa_score)) +
  geom_point(aes(color = region), size = 3, alpha = 0.7) +
  geom_smooth(method = "lm", se = TRUE, color = "gray30",
              linetype = "dashed", alpha = 0.2) +
  scale_color_manual(values = c("#E74C3C", "#2ECC71", "#3498DB", "#F39C12")) +
  labs(
    x = "Gasto en educación (% del PIB)",
    y = "Puntaje PISA promedio",
    color = "Región"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

### Cambio en el tiempo: ¿hay tendencia?

```{r}
#| label: fig-serie-tiempo
#| fig-cap: "Evolución de la tasa de pobreza en tres países latinoamericanos (datos simulados)"
#| echo: false
#| message: false

library(tidyverse)

set.seed(2024)
serie <- expand_grid(
  anio = 2000:2023,
  pais = c("País A", "País B", "País C")
) |>
  mutate(
    pobreza = case_when(
      pais == "País A" ~ 55 - 1.5 * (anio - 2000) + rnorm(n(), 0, 2),
      pais == "País B" ~ 45 - 0.5 * (anio - 2000) + rnorm(n(), 0, 2),
      pais == "País C" ~ 40 - 1.0 * (anio - 2000) +
        ifelse(anio >= 2015, 0.8 * (anio - 2015), 0) + rnorm(n(), 0, 2)
    )
  )

ggplot(serie, aes(x = anio, y = pobreza, color = pais)) +
  geom_line(linewidth = 1.1) +
  geom_point(size = 1.5, alpha = 0.6) +
  scale_color_manual(values = c("#E74C3C", "#3498DB", "#2ECC71")) +
  labs(
    x = "Año",
    y = "Tasa de pobreza (%)",
    color = ""
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

### Comparación entre grupos: ¿hay diferencias?

```{r}
#| label: fig-barras
#| fig-cap: "Satisfacción con servicios públicos por quintil de ingreso (datos simulados)"
#| echo: false
#| message: false

library(tidyverse)

set.seed(55)
satisfaccion <- tibble(
  quintil = factor(rep(paste0("Q", 1:5), each = 3),
                   levels = paste0("Q", 1:5)),
  servicio = rep(c("Salud", "Educación", "Transporte"), 5),
  satisfaccion = c(
    2.1, 2.5, 1.8,
    2.8, 3.0, 2.2,
    3.2, 3.5, 2.8,
    3.8, 3.9, 3.5,
    4.2, 4.3, 4.0
  )
)

ggplot(satisfaccion, aes(x = quintil, y = satisfaccion, fill = servicio)) +
  geom_col(position = "dodge", width = 0.7) +
  scale_fill_manual(values = c("#3498DB", "#2ECC71", "#F39C12")) +
  labs(
    x = "Quintil de ingreso",
    y = "Satisfacción promedio (1-5)",
    fill = "Servicio"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

### Datos geográficos: ¿dónde ocurre?

```{r}
#| label: fig-mapa
#| fig-cap: "Índice de desarrollo humano en América del Sur (datos simulados)"
#| echo: false
#| message: false
#| warning: false

library(tidyverse)
library(rnaturalearth)
library(rnaturalearthdata)
library(sf)

sudamerica <- ne_countries(scale = "medium", continent = "South America",
                           returnclass = "sf")

set.seed(77)
sudamerica$idh <- runif(nrow(sudamerica), 0.55, 0.85)

ggplot(sudamerica) +
  geom_sf(aes(fill = idh), color = "white", linewidth = 0.3) +
  scale_fill_viridis_c(option = "plasma", name = "IDH",
                       limits = c(0.5, 0.9),
                       labels = scales::number_format(accuracy = 0.01)) +
  labs(title = "Índice de Desarrollo Humano") +
  theme_void() +
  theme(
    legend.position = "right",
    plot.title = element_text(hjust = 0.5, face = "bold")
  )
```

### Proporciones: ¿cómo se reparte el total?

Una nota sobre el gráfico de torta (*pie chart*): tiene mala fama, y con razón. El ojo humano es **mucho peor** comparando ángulos que comparando longitudes. Si tienes más de 3-4 categorías, un gráfico de barras siempre es más legible.

¿Cuándo sí funciona la torta?

- Cuando tienes 2-3 categorías y quieres mostrar proporciones simples (ej.: 70% urbano, 30% rural).
- Cuando la audiencia espera una torta (presentaciones ejecutivas, informes de prensa).

En todos los demás casos: **barras ordenadas de mayor a menor.** @wilke2019 argumenta que incluso con pocas categorías, las barras son casi siempre superiores.

## El storytelling con datos

@knaflic2015 propone que visualizar datos no es suficiente; necesitas **contar una historia** con ellos. Su framework tiene tres pasos:

### 1. Contexto

¿Quién es tu audiencia? ¿Qué necesitan saber? ¿Qué acción quieres que tomen? Si presentas resultados a un comité de política educativa, tu gráfico necesita ser diferente que si presentas en un congreso académico.

### 2. Elegir la visualización adecuada

No hay un "mejor gráfico." Hay el gráfico adecuado para tu mensaje:

| Tu mensaje es sobre... | Usa... | No uses... |
|---|---|---|
| Comparación entre categorías | Barras (horizontales si hay muchas) | Tortas con 10+ categorías |
| Tendencia temporal | Líneas | Barras apiladas (confunden) |
| Distribución | Histograma, densidad, boxplot | Tortas (no muestran distribución) |
| Relación entre dos variables | Scatter plot | Barras (no muestran la relación) |
| Composición del total | Barras apiladas (100%) | Tortas 3D (nunca) |
| Geografía | Mapas coropléticos | Tablas con nombres de regiones |

### 3. Eliminar ruido y dirigir la atención

Usa **atributos preatentivos** para que el ojo vaya donde quieres: color, tamaño, posición, forma. Resalta lo importante y atenúa lo secundario.

Ejemplo: si quieres que tu audiencia se fije en que el País C revirtió su tendencia de pobreza, haz su línea más gruesa y de un color más intenso, y atenúa las otras con gris.

## Tablas: la visualización olvidada

Una tabla bien hecha es una forma de visualización. Una tabla mal hecha es una tortura.

### Principios para buenas tablas

1. **Alinea los números a la derecha** (para que los dígitos se alineen).
2. **Usa formato consistente** (misma cantidad de decimales).
3. **Elimina bordes innecesarios.** Las mejores tablas usan solo líneas horizontales (arriba, abajo, y separando el header).
4. **Redondea.** Nadie necesita 6 decimales. Para coeficientes de regresión, 2-3 decimales suelen bastar.
5. **Señala visualmente** los resultados más importantes (negrita, asteriscos de significancia, sombreado).
6. **El título debe ser informativo,** no genérico.

| ❌ Tabla mala | ✅ Tabla buena |
|---|---|
| "Tabla 3: Resultados" | "Tabla 3: El programa aumentó la matrícula escolar en 8 puntos porcentuales" |
| Bordes por todos lados | Solo líneas horizontales |
| 6 decimales | 2-3 decimales |
| Sin notas al pie | Notas sobre significancia, fuente, y N |

### Tabla vs. gráfico: ¿cuándo usar cada uno?

- **Usa tabla** cuando el lector necesita valores exactos (coeficientes de regresión, estadísticos descriptivos para replicación).
- **Usa gráfico** cuando el lector necesita ver patrones, tendencias, o comparaciones.
- **Nunca dupliques:** si tienes un gráfico que muestra lo mismo que la tabla, deja uno de los dos en un apéndice.

## Los 7 pecados capitales de la visualización

| Pecado | Ejemplo | Solución |
|---|---|---|
| **Gráfico de torta con 15 categorías** | Imposible distinguir las porciones | Usa barras ordenadas |
| **3D sin razón** | Distorsiona las proporciones | Siempre 2D |
| **Eje Y truncado** | Exagera diferencias pequeñas | Empieza en cero (o justifica por qué no) |
| **Demasiados colores** | Arcoíris ilegible | Máximo 5-6 colores, paleta coherente |
| **Doble eje Y** | Confusión garantizada | Dos gráficos separados |
| **Leyenda lejos del dato** | El lector va y viene entre gráfico y leyenda | Etiquetas directas |
| **Gráfico sin título** | ¿Qué estoy mirando? | Título que responde una pregunta |

## Herramientas

### R + ggplot2

El ecosistema más poderoso para visualización de datos en ciencias sociales. La curva de aprendizaje es empinada, pero la capacidad es prácticamente ilimitada. Todo lo que ves en este capítulo está hecho con ggplot2. @healy2018 tiene un libro completo (gratuito online) que enseña visualización con R de forma excelente.

Paquetes complementarios útiles:

- **patchwork:** Combinar múltiples gráficos.
- **sf + rnaturalearth:** Mapas.
- **plotly:** Gráficos interactivos (con `ggplotly()`).
- **scales:** Formateo de ejes.
- **ggrepel:** Etiquetas que no se superponen.
- **ggridges:** Ridge plots para comparar muchas distribuciones.
- **ggthemes:** Temas prediseñados (theme_economist, theme_fivethirtyeight).
- **gganimate:** Animaciones (para presentaciones, no para papers).

### Python + matplotlib/seaborn

Alternativa poderosa, especialmente si ya programas en Python. Seaborn hace gráficos estadísticos elegantes con poco código. Matplotlib es más flexible pero más verboso.

### Tableau / Power BI

Para análisis exploratorio rápido y dashboards. No requieren programación, pero son menos flexibles para publicación académica. Útiles para explorar datos antes de decidir qué gráficos incluir en el paper.

### Datawrapper / Flourish / RAWGraphs

Herramientas web gratuitas para gráficos rápidos y publicables. Excelentes para periodismo de datos y presentaciones. Datawrapper es especialmente bueno para gráficos simples y limpios.

### Para mapas

- **QGIS** (gratuito, open source): El estándar para análisis geoespacial.
- **Mapbox / Leaflet:** Mapas interactivos web.
- **GeoDa:** Análisis espacial exploratorio.

::: {.callout-important}
## Reflexión

La visualización no es la última etapa de tu investigación. Es una herramienta de **pensamiento.** Graficar tus datos tempranamente te ayuda a encontrar patrones, detectar errores, y generar hipótesis. No esperes a "tener los resultados" para empezar a visualizar. Grafica desde el primer día. Las mejores preguntas de investigación a menudo surgen de un gráfico exploratorio que reveló algo inesperado.
:::

::: {.callout-tip}
## Ejercicio

1. Toma los datos de tu investigación (o un dataset público como ENAHO, CASEN, o los datos abiertos del Banco Mundial).
2. Haz **tres gráficos** que cuenten la historia principal de tus hallazgos. Para cada uno, escribe un título que sea una afirmación (no una descripción).
3. Muéstralos a alguien que no sepa nada de tu tema. ¿Entienden el mensaje sin explicación adicional?
4. Si no entienden, rediseña. Si entienden, felicidades: ya eres mejor comunicador visual que el 80% de los académicos.
5. Toma un gráfico de tu tesis (o de un paper que estés leyendo) y evalúalo: ¿cumple con el ratio data-ink? ¿Usa color con propósito? ¿El título es informativo? ¿Es accesible para daltónicos? Rediseñalo aplicando los principios de este capítulo.
:::
